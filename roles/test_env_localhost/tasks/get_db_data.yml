---
- name: |
    "Try to access the RDS directly using internet.
    "mysql://{{ db_user }}:{{ db_password }}@{{ rds_db_host }}/{{ rds_db_name }}"
    "It should >>fail<<, as the playbook create a SG that doesn't allow it."
  shell: "mysql -u{{ db_user }} -p{{ db_password }} -h {{ rds_db_host }} {{ rds_db_name }} {{ db_query }}"
  ignore_errors: true
  register: test_result

- name: "Write test logs"
  write_test_logs:
    log_file: "tests_result.log"
    log_dir: "{{ playbook_dir }}/logs/"
    host: "{{ ansible_host }}"
    input: "{{ test_result }}"
    type: "database"
  register: debug